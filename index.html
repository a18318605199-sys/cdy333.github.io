html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MARINOW | 未来服装制造生态</title>
    <style>
        /* --- 核心变量与重置 --- */
        :root {
            --bg-color: #0b0b0b;
            --card-bg: #141414;
            --text-main: #ffffff;
            --text-muted: #888888;
            --accent-gradient: linear-gradient(90deg, #7b61ff 0%, #4facfe 100%);
            --border-color: #222;
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --btn-hover-bg: rgba(255, 255, 255, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; cursor: none; /* 隐藏默认光标 */ }
        
        html { scroll-behavior: smooth; }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font-family);
            line-height: 1.6;
            overflow-x: hidden;
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0b0b0b; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }

        a, button, .clickable { cursor: none; }

        /* --- 自定义光标 --- */
        .cursor-dot, .cursor-outline { position: fixed; top: 0; left: 0; transform: translate(-50%, -50%); border-radius: 50%; z-index: 9999; pointer-events: none; }
        .cursor-dot { width: 5px; height: 5px; background-color: white; }
        .cursor-outline { width: 30px; height: 30px; border: 1px solid rgba(255, 255, 255, 0.5); transition: width 0.2s, height 0.2s, background-color 0.2s; }
        body.hovering .cursor-outline { width: 50px; height: 50px; background-color: rgba(255, 255, 255, 0.1); border-color: transparent; backdrop-filter: blur(2px); }
        body.hovering .cursor-dot { opacity: 0; } 

        /* --- 通用工具类 --- */
        .container { max-width: 1200px; margin: 0 auto; padding: 0 40px; }
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.6s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .reveal { opacity: 0; transform: translateY(30px); transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1); }
        .reveal.active { opacity: 1; transform: translateY(0); }
        img { opacity: 0; transition: opacity 0.5s ease-in-out; }
        img.loaded { opacity: 1; }

        /* --- 导航栏 --- */
        header {
            position: fixed; top: 0; left: 0; right: 0; height: 80px;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 40px; background: rgba(11, 11, 11, 0.85);
            backdrop-filter: blur(12px); z-index: 1000;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .logo { display: flex; align-items: center; height: 100%; padding: 10px 0; z-index: 1002;}
        .logo-img { height: 30px; width: auto; object-fit: contain; }
        .nav-group { display: flex; flex-direction: row; align-items: center; gap: 15px; }
        .nav-btn {
            color: var(--text-muted); padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; font-weight: 500;
            display: flex; align-items: center; gap: 8px; transition: all 0.2s; border: 1px solid transparent; background: transparent;
        }
        .nav-btn:hover, .nav-btn.nav-active { background: var(--btn-hover-bg); color: white; }
        .cta-btn {
            background: white; color: black; padding: 8px 20px;
            border-radius: 20px; font-weight: 700; font-size: 0.9rem; margin-left: 10px; border: none;
        }
        .cta-btn:hover { transform: scale(1.05); background: #e0e0e0; }
        .cart-icon-container { position: relative; margin-left: 10px; padding: 8px; }
        .cart-badge {
            position: absolute; top: 0; right: 0;
            background: #e74c3c; color: white; font-size: 10px; font-weight: bold;
            width: 16px; height: 16px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; transform: scale(0.5); transition: all 0.3s;
        }
        .cart-badge.show { opacity: 1; transform: scale(1); }
        .mobile-menu-btn { display: none; color: white; font-size: 24px; z-index: 1002; border: none; background: none;}
        .mobile-nav-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            background: rgba(0,0,0,0.95); backdrop-filter: blur(10px);
            z-index: 1001; display: flex; flex-direction: column;
            align-items: center; justify-content: center; gap: 30px;
            transform: translateY(-100%); transition: transform 0.4s;
        }
        .mobile-nav-overlay.open { transform: translateY(0); }
        .mobile-nav-link { font-size: 1.5rem; font-weight: bold; color: white; }
        .icon { width: 20px; height: 20px; fill: none; stroke: currentColor; stroke-width: 1.8; stroke-linecap: round; stroke-linejoin: round; }

        /* --- 全局搜索模态框 --- */
        .search-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(15px);
            z-index: 2000; display: none; justify-content: center; align-items: flex-start; padding-top: 100px;
            opacity: 0; transition: opacity 0.3s;
        }
        .search-modal.open { display: flex; opacity: 1; }
        .search-container { width: 600px; max-width: 90%; position: relative; }
        .search-input {
            width: 100%; background: transparent; border: none; border-bottom: 2px solid #333;
            font-size: 2rem; color: white; padding: 20px 0; outline: none;
        }
        .search-input::placeholder { color: #444; }
        .search-results { margin-top: 20px; max-height: 60vh; overflow-y: auto; }
        .search-result-item {
            padding: 15px; border-bottom: 1px solid #222; cursor: pointer; display: flex; align-items: center; gap: 15px; transition: 0.2s;
        }
        .search-result-item:hover { background: rgba(255,255,255,0.05); padding-left: 25px; }
        .search-result-item img { width: 40px; height: 40px; object-fit: cover; border-radius: 4px; opacity: 1; }

        /* --- 首页 --- */
        #home-hero { height: 80vh; position: relative; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding-top: 80px; overflow: hidden; }
        .hero-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; background: #111;}
        .hero-bg img { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; 
            opacity: 0; transform: scale(1); transition: opacity 1.5s ease-in-out, transform 8s ease-out; 
        }
        .hero-bg img.active { opacity: 1; transform: scale(1.1); }
        .hero-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(rgba(0,0,0,0.3), rgba(11,11,11,1)); z-index: 1; }
        
        /* Modified hero-content to move text down */
        .hero-content { position: relative; z-index: 2; padding: 0 20px; margin-top: 150px; }
        
        h1.hero-title { font-size: 5rem; line-height: 1.1; font-weight: 800; margin-bottom: 20px; }
        .gradient-text { background: var(--accent-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .hero-subtitle { font-size: 1.2rem; color: #ccc; max-width: 600px; margin-bottom: 40px; margin-left: auto; margin-right: auto; }
        .btn-main { padding: 15px 35px; background: white; color: black; border-radius: 30px; font-weight: 600; font-size: 1rem; transition: transform 0.2s; display: inline-block; border: none;}
        .btn-main:hover { transform: scale(1.05); }
        .home-grid { display: grid; grid-template-columns: repeat(4, 1fr); border-top: 1px solid var(--border-color); }
        .grid-item { padding: 40px; display: flex; flex-direction: column; justify-content: center; border-right: 1px solid var(--border-color); transition: background 0.3s; cursor: pointer; }
        .grid-item:last-child { border-right: none; }
        .grid-item:hover { background: #1a1a1a; }
        .grid-icon { margin-bottom: 15px; color: var(--text-muted); }
        .grid-icon svg { width: 36px; height: 36px; stroke-width: 1.5; }
        .grid-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 5px; }
        .grid-desc { font-size: 0.9rem; color: var(--text-muted); }

        /* --- 页面通用 --- */
        .page-section { padding: 140px 40px 60px; min-height: 100vh; }
        .section-header { margin-bottom: 50px; border-bottom: 1px solid var(--border-color); padding-bottom: 20px; display: flex; justify-content: space-between; align-items: flex-end;}
        .section-title { font-size: 3rem; font-weight: 700; }
        .btn-back { background: transparent; border: 1px solid var(--border-color); color: white; padding: 10px 20px; border-radius: 20px; transition: 0.2s; }
        .btn-back:hover { background: white; color: black; }

        /* --- 产品 (机器) --- */
        .product-layout { display: flex; flex-direction: column; gap: 40px; }
        .product-img { width: 100%; aspect-ratio: 16 / 9; background: #111; border-radius: 12px; overflow: hidden; position: relative; }
        .product-img img { width: 100%; height: 100%; object-fit: cover; object-position: center; }
        .product-info-container { display: grid; grid-template-columns: 2fr 1fr; gap: 60px; }
        .info-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 1px solid #333; padding-bottom: 20px; }
        .price-tag { font-size: 2.5rem; color: #4facfe; font-weight: bold; }
        .product-description p { font-size: 1.1rem; color: #ccc; line-height: 1.8; margin-bottom: 20px; }
        .spec-box { background: #1a1a1a; padding: 30px; border-radius: 12px; border: 1px solid #333; }
        .spec-list li { padding: 15px 0; border-bottom: 1px solid #333; color: #ccc; display: flex; justify-content: space-between; }
        .spec-list li strong { color: white; }
        .btn-buy { width: 100%; padding: 20px; background: var(--accent-gradient); border: none; color: white; font-weight: bold; font-size: 1.1rem; border-radius: 4px; margin-top: 20px; transition: 0.3s; }
        .btn-buy:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(79, 172, 254, 0.4); }
        .slider-btn { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.4); color: white; border: none; width: 60px; height: 60px; border-radius: 50%; font-size: 24px; display: flex; align-items: center; justify-content: center; z-index: 10; cursor: pointer; transition: all 0.2s; backdrop-filter: blur(5px); }
        .slider-btn:hover { background: rgba(255, 255, 255, 0.2); }
        .prev-btn { left: 30px; }
        .next-btn { right: 30px; }
        .slider-dots { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); display: flex; gap: 12px; }
        .dot { width: 12px; height: 12px; background: rgba(255,255,255,0.3); border-radius: 50%; cursor: pointer; transition: 0.2s; }
        .dot.active { background: white; transform: scale(1.2); }
        .detail-section { margin-top: 120px; padding: 60px 0; border-top: 1px solid #222; }
        .detail-grid-split { display: grid; grid-template-columns: 1fr 1fr; align-items: center; gap: 80px; }
        .detail-text h3 { font-size: 2.5rem; margin-bottom: 20px; background: linear-gradient(90deg, #fff, #888); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .detail-text p { color: #999; font-size: 1.1rem; line-height: 1.7; }
        .detail-img-box { width: 100%; background: #111; border-radius: 16px; padding: 40px; display: flex; justify-content: center; align-items: center; }
        .detail-img-box img { max-width: 100%; height: auto; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5)); }
        .detail-full-width { margin-top: 100px; text-align: center; }
        .detail-full-img { width: 100%; margin-top: 40px; border-radius: 12px; border: 1px solid #333; background: #111;}

        /* --- 设计 (商城) --- */
        .design-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 30px; }
        .design-card { background: var(--card-bg); border-radius: 8px; overflow: hidden; transition: transform 0.3s; cursor: pointer; }
        .design-card:hover { transform: translateY(-10px); }
        .design-card:hover .dc-image { transform: scale(1.05); }
        .dc-image { height: 450px; width: 100%; object-fit: cover; object-position: top center; transition: transform 0.5s ease; background: #111; }
        .dc-info { padding: 20px; }
        .dc-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .badge { font-size: 0.7rem; background: rgba(123, 97, 255, 0.2); color: #7b61ff; padding: 4px 8px; border-radius: 4px; }
        .designer-row { display: flex; align-items: center; gap: 10px; margin-top: 15px; cursor: pointer; }
        .avatar { width: 30px; height: 30px; border-radius: 50%; object-fit: cover; background: #333;}
        
        /* --- 详情页增强：制造数据 --- */
        .detail-specs {
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 30px; margin-bottom: 30px;
            background: rgba(255,255,255,0.03); padding: 20px; border-radius: 8px; border: 1px solid #222;
        }
        .spec-item { display: flex; flex-direction: column; gap: 5px; }
        .spec-label { font-size: 0.75rem; color: #666; text-transform: uppercase; letter-spacing: 1px; }
        .spec-value { font-size: 1.1rem; color: #fff; font-weight: bold; font-family: monospace; color: #4facfe; }
        
        /* NEW: Reviews Section in Detail Page */
        .detail-reviews-section { margin-top: 60px; border-top: 1px solid #333; padding-top: 40px; }
        .detail-reviews-title { font-size: 1.5rem; color: #fff; margin-bottom: 20px; }
        .review-card { background: #1a1a1a; padding: 20px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #222; }
        .review-header { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .review-user { display: flex; align-items: center; gap: 10px; font-weight: bold; color: #fff; }
        .review-avatar { width: 25px; height: 25px; border-radius: 50%; background: #333; object-fit: cover; }
        .review-rating { color: #f1c40f; font-size: 0.9rem; }
        .review-text { color: #999; font-size: 0.95rem; line-height: 1.5; }

        /* --- 工作台 --- */
        .workbench-ui { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 40px; display: grid; grid-template-columns: 2fr 1fr; gap: 40px; }
        .preview-area { 
            background: #000; height: 600px; border-radius: 8px; display: flex; align-items: center; justify-content: center; 
            border: 1px dashed #333; color: #555; flex-direction: column; overflow: hidden; position: relative; 
            perspective: 1000px; 
        }
        .preview-content {
            width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center;
            transform-style: preserve-3d; transition: transform 0.1s ease-out;
        }
        .preview-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.5; background-size: cover; pointer-events: none; display: none; mix-blend-mode: multiply; }
        .preview-color { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; pointer-events: none; mix-blend-mode: color; transition: opacity 0.3s; }
        @keyframes rotate-slow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .workbench-icon.working { animation: rotate-slow 10s linear infinite; color: #4facfe !important; opacity: 1 !important;}
        .control-panel h3 { margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .form-group { margin-bottom: 25px; }
        .form-group label { display: block; margin-bottom: 10px; color: #888; }
        .material-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 15px; }
        .material-card { background: #0a0a0a; border: 1px solid #333; border-radius: 8px; overflow: hidden; cursor: pointer; transition: all 0.2s; position: relative;}
        .material-card:hover { border-color: #666; transform: translateY(-2px); }
        .material-card.selected { border-color: #7b61ff; box-shadow: 0 0 10px rgba(123, 97, 255, 0.2); background: rgba(123, 97, 255, 0.05); }
        .material-card.selected::after { content: '✓'; position: absolute; top: 5px; right: 5px; color: #7b61ff; font-weight: bold;}
        .material-img { width: 100%; height: 70px; object-fit: cover; display: block; background: #222;}
        .material-name { padding: 8px; font-size: 0.75rem; color: #ccc; text-align: center; }
        .color-options { display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap; }
        .color-circle { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 2px solid #333; transition: transform 0.2s;}
        .color-circle:hover { transform: scale(1.1); }
        .color-circle.selected { border-color: white; transform: scale(1.2); box-shadow: 0 0 10px rgba(255,255,255,0.3); }
        .progress-wrapper { margin-top: 30px; display: none; }
        .progress-track { width: 100%; height: 6px; background: #333; border-radius: 3px; overflow: hidden; }
        .progress-bar { height: 100%; width: 0%; background: var(--accent-gradient); transition: width 0.3s; }
        .status-text { margin-top: 15px; font-size: 0.85rem; color: #4facfe; text-align: left; font-family: monospace; background: #0a0a0a; padding: 10px; border-radius: 4px; border-left: 3px solid #4facfe;}

        /* --- NEW: Interactive Timeline Styles (Enhanced) --- */
        #fabrication-process { display: none; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; position: relative; padding-top: 100px; }
        
        /* Enlarged Display Card */
        .fab-display-card {
            width: 1000px; max-width: 95%; height: 500px; 
            background: #1a1a1a; border: 1px solid #333;
            border-radius: 16px; margin-bottom: 60px; display: flex; overflow: hidden;
            box-shadow: 0 30px 80px rgba(0,0,0,0.6); transition: all 0.3s;
        }
        .fab-display-img { 
            width: 60%; height: 100%; object-fit: cover; background: #000; 
            opacity: 1; transition: opacity 0.4s ease-in-out; 
        }
        .fab-display-img.fade-out { opacity: 0; }
        
        .fab-display-info { width: 40%; padding: 50px; display: flex; flex-direction: column; justify-content: center; text-align: left; }
        .fab-display-title { font-size: 2.5rem; margin-bottom: 20px; color: #fff; line-height: 1.1; font-weight: 800; }
        .fab-display-desc { color: #bbb; font-size: 1.1rem; line-height: 1.7; transition: opacity 0.3s;}
        
        .fab-timeline-container { width: 1000px; max-width: 95%; position: relative; height: 80px; display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;}
        .fab-progress-line-bg { position: absolute; top: 50%; left: 0; width: 100%; height: 6px; background: #222; transform: translateY(-50%); z-index: 0; border-radius: 3px;}
        
        /* Animated Progress Fill */
        @keyframes flow { 0% { background-position: 0 0; } 100% { background-position: 50px 50px; } }
        .fab-progress-line-fill { 
            position: absolute; top: 50%; left: 0; width: 0%; height: 6px; 
            background: linear-gradient(45deg, #7b61ff, #4facfe, #7b61ff); background-size: 50px 50px;
            animation: flow 2s linear infinite;
            transform: translateY(-50%); z-index: 1; transition: width 0.3s linear; 
            box-shadow: 0 0 15px rgba(123, 97, 255, 0.5); border-radius: 3px;
        }
        
        .fab-steps { position: relative; width: 100%; display: flex; justify-content: space-between; z-index: 2; }
        
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(79, 172, 254, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(79, 172, 254, 0); } 100% { box-shadow: 0 0 0 0 rgba(79, 172, 254, 0); } }
        
        .fab-node { 
            width: 50px; height: 50px; background: #111; border: 3px solid #444; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; cursor: pointer; 
            transition: all 0.3s; color: #666; font-size: 0.9rem; font-weight: bold;
        }
        .fab-node:hover { transform: scale(1.2); border-color: #fff; color: white; }
        .fab-node.active { 
            background: #4facfe; border-color: #fff; color: #000; 
            animation: pulse 2s infinite;
        }
        .fab-node.completed { background: #7b61ff; border-color: #7b61ff; color: white; }

        /* --- 社区 --- */
        .community-feed { max-width: 800px; margin: 0 auto; }
        .feed-post { background: var(--card-bg); padding: 30px; border-radius: 12px; margin-bottom: 30px; border: 1px solid var(--border-color); transition: transform 0.2s; }
        .feed-post:hover { border-color: #444; }
        .post-header { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        .user-tag { font-size: 0.8rem; padding: 2px 8px; border-radius: 4px; background: #333; }
        .tag-designer { color: #d4a5ff; background: rgba(212, 165, 255, 0.1); }
        .tag-factory { color: #4facfe; background: rgba(79, 172, 254, 0.1); }
        .tag-admin { color: #ff6b6b; background: rgba(255, 107, 107, 0.1); }
        .post-actions { margin-top: 20px; padding-top: 15px; border-top: 1px solid #222; display: flex; gap: 25px; color: #666; font-size: 0.9rem; }
        .post-action-item { cursor: pointer; display: flex; align-items: center; gap: 6px; transition: 0.2s; border: none; background: transparent; color: inherit; font-size: inherit; }
        .post-action-item:hover { color: #4facfe; }
        .post-action-item.liked { color: #e74c3c; }
        .post-action-item.liked svg { fill: #e74c3c; stroke: #e74c3c; }
        
        /* NEW: Post Images Grid - Small Squares */
        .post-images { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px; margin-bottom: 10px; max-width: 400px; }
        .post-img { width: 100%; aspect-ratio: 1/1; object-fit: cover; border-radius: 6px; background: #222; border: 1px solid #333; transition: transform 0.2s; }
        .post-img:hover { transform: scale(1.05); border-color: #4facfe; }

        /* --- 购物车 --- */
        .cart-layout { display: grid; grid-template-columns: 2fr 1fr; gap: 40px; }
        .cart-item { display: flex; gap: 20px; background: #111; padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #222; align-items: center; }
        .cart-item img { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; background: #000; }
        .cart-item-info { flex: 1; }
        .cart-item-title { font-size: 1.1rem; font-weight: bold; color: white; }
        .cart-item-type { font-size: 0.85rem; color: #888; margin-top: 4px; text-transform: uppercase; letter-spacing: 1px; }
        .cart-item-price { font-size: 1.1rem; color: white; font-weight: bold; }
        .remove-btn { color: #e74c3c; font-size: 0.9rem; cursor: pointer; margin-left: 20px; }
        .remove-btn:hover { text-decoration: underline; }
        .cart-summary { background: #161617; padding: 30px; border-radius: 12px; border: 1px solid #222; height: fit-content; }
        .summary-row { display: flex; justify-content: space-between; margin-bottom: 15px; color: #ccc; }
        .summary-total { display: flex; justify-content: space-between; margin-top: 20px; padding-top: 20px; border-top: 1px solid #333; font-size: 1.5rem; font-weight: bold; color: white; }
        .empty-cart-msg { text-align: center; color: #666; padding: 60px 0; font-size: 1.2rem; }

        /* --- Toast --- */
        #toast-container { position: fixed; top: 100px; left: 50%; transform: translateX(-50%); z-index: 2000; pointer-events: none; }
        .toast { background: rgba(20, 20, 20, 0.95); backdrop-filter: blur(10px); color: white; padding: 12px 24px; border-radius: 30px; border: 1px solid #333; margin-bottom: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); font-size: 0.9rem; display: flex; align-items: center; gap: 10px; opacity: 0; transform: translateY(-20px); transition: all 0.3s ease; }
        .toast.show { opacity: 1; transform: translateY(0); }

        /* --- Mobile Media Queries --- */
        @media (max-width: 768px) {
            h1.hero-title { font-size: 3rem; }
            .home-grid { grid-template-columns: 1fr; }
            .grid-item { border-right: none; border-bottom: 1px solid #222; padding: 30px; flex-direction: row; align-items: center; justify-content: flex-start; gap: 20px; text-align: left; }
            .grid-icon { margin-bottom: 0; }
            .product-layout { flex-direction: column; }
            .product-info-container { grid-template-columns: 1fr; }
            .detail-grid-split { grid-template-columns: 1fr; }
            .workbench-ui { grid-template-columns: 1fr; padding: 20px; }
            .nav-group .nav-btn { display: none; } 
            .mobile-menu-btn { display: block; } 
            .header { padding: 0 20px; }
            .footer-content { grid-template-columns: 1fr; }
            .footer-bottom { flex-direction: column; gap: 20px; text-align: center; }
            .cart-layout { grid-template-columns: 1fr; }
            .cursor-dot, .cursor-outline { display: none; } /* 移动端禁用自定义光标 */
            #back-to-top { bottom: 20px; right: 20px; width: 40px; height: 40px; }
            .detail-specs { grid-template-columns: 1fr; }
            .fab-display-card { flex-direction: column; height: auto; }
            .fab-display-img { width: 100%; height: 200px; }
            .fab-display-info { width: 100%; padding: 20px; }
        }

        /* --- Text Pages & Enhanced Content --- */
        .text-page { max-width: 900px; margin: 0 auto; }
        .text-page h3 { color: white; margin-top: 50px; margin-bottom: 25px; font-size: 1.8rem; border-bottom: 1px solid #222; padding-bottom: 15px; }
        .text-page p { color: #ccc; line-height: 1.8; margin-bottom: 25px; font-size: 1.05rem; text-align: justify; }
        .text-page ul { margin-bottom: 30px; list-style: disc; padding-left: 20px; color: #aaa; }
        .text-page li { margin-bottom: 10px; }

        .team-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 30px; margin-top: 40px; }
        .team-member { text-align: center; background: #111; padding: 30px; border-radius: 12px; border: 1px solid #222; }
        .team-member img { width: 100px; height: 100px; border-radius: 50%; margin-bottom: 15px; object-fit: cover; }
        .team-member h4 { color: white; margin-bottom: 5px; }
        .team-member p { color: #666; font-size: 0.9rem; }

        .legal-text { font-family: 'Courier New', monospace; color: #aaa; background: #111; padding: 40px; border-radius: 12px; border: 1px solid #222; white-space: pre-wrap; line-height: 1.6; font-size: 0.9rem; }

        .form-input { width: 100%; background: #111; border: 1px solid #333; color: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-family: inherit; }
        .form-input:focus { border-color: #4facfe; }
        .form-textarea { height: 150px; resize: none; }
        .faq-item { border-bottom: 1px solid #333; padding: 20px 0; }
        .faq-q { font-weight: bold; color: white; cursor: pointer; font-size: 1.1rem; display: flex; justify-content: space-between; }
        .faq-a { color: #888; margin-top: 10px; display: none; line-height: 1.6; padding-right: 20px; }
        .faq-item.active .faq-a { display: block; }
        .faq-item:hover .faq-q { color: #4facfe; }
        
        .grid-cards-simple { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; }
        .simple-card { background: rgba(20,20,20,0.6); padding: 30px; border-radius: 12px; border: 1px solid #222; backdrop-filter: blur(10px); }
        .simple-card h4 { color: white; margin-bottom: 10px; font-size: 1.3rem; }
        .simple-card p { color: #bbb; font-size: 0.95rem; line-height: 1.6; }
        
        #materials { background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.95)), url('materials_bg.png'); background-size: cover; background-position: center; background-attachment: fixed; }
        
        .job-item { display: flex; justify-content: space-between; align-items: center; padding: 30px; border-bottom: 1px solid #333; transition: background 0.2s; }
        .job-item:hover { background: #111; }
        .benefits-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 50px; }
        .benefit-card { text-align: center; padding: 25px; background: #111; border-radius: 10px; border: 1px solid #222; }
        .benefit-card h4 { color: #fff; margin-bottom: 5px; }
        .benefit-card p { color: #666; font-size: 0.9rem; }
        
        .press-kit-box { background: linear-gradient(135deg, #1a1a1a, #0b0b0b); padding: 60px; border-radius: 16px; border: 1px solid #333; text-align: center; margin-bottom: 60px; }
        .news-item { margin-bottom: 40px; padding-bottom: 30px; border-bottom: 1px solid #222; }
        .news-meta { color: #4facfe; font-size: 0.8rem; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; font-weight: bold;}
        .news-title { font-size: 1.6rem; margin-bottom: 12px; color: white; }
        .news-snippet { color: #999; font-size: 1rem; }
        
        /* Back to Top */
        #back-to-top {
            position: fixed; bottom: 30px; right: 30px;
            width: 50px; height: 50px; border-radius: 50%;
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2); color: white;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; z-index: 900; transition: all 0.3s ease;
            opacity: 0; pointer-events: none; transform: translateY(20px);
        }
        #back-to-top.visible { opacity: 1; pointer-events: auto; transform: translateY(0); }
        #back-to-top:hover { background: white; color: black; transform: scale(1.1); }
        
        /* Footer */
        footer { background-color: #050505; padding: 80px 40px 40px; border-top: 1px solid #222; margin-top: 80px; }
        .footer-content { max-width: 1400px; margin: 0 auto; display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 40px; }
        .footer-col h4 { color: white; margin-bottom: 20px; font-size: 1.1rem; }
        .footer-col ul li { margin-bottom: 12px; }
        .footer-col ul li a { color: var(--text-muted); font-size: 0.95rem; }
        .footer-col ul li a:hover { color: #4facfe; text-decoration: underline; }
        .footer-logo-img { height: 25px; opacity: 0.8; margin-bottom: 20px; }
        .footer-bottom { max-width: 1400px; margin: 60px auto 0; padding-top: 30px; border-top: 1px solid #222; display: flex; justify-content: space-between; color: #666; font-size: 0.9rem; }

    </style>
</head>
<body>

    <div id="toast-container"></div>

    <!-- Payment Modal -->
    <div id="payment-modal" class="search-modal" style="z-index: 3000; align-items: center;">
        <div class="spec-box" style="width: 400px; max-width: 90%; text-align: center; position: relative; background: #1a1a1a; border: 1px solid #333;">
            <button style="position: absolute; top: 15px; right: 15px; background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;" onclick="closePaymentModal()">×</button>
            <div style="margin-bottom: 20px;">
                <svg class="icon" style="width: 60px; height: 60px; color: #4caf50;" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>
            </div>
            <h2 style="margin-bottom: 10px;">Payment Successful!</h2>
            <img id="payment-display-img" src="" style="width: 150px; height: 150px; object-fit: cover; border-radius: 8px; margin: 20px 0;">
            <p style="color: #888; margin-bottom: 30px;">Your design pattern is ready for fabrication.</p>
            <button class="btn-buy" onclick="proceedToWorkbench()">Go to Workbench</button>
        </div>
    </div>

    <!-- Workbench Start Modal -->
    <div id="workbench-start-modal" class="search-modal" style="z-index: 3000; align-items: center;">
        <div class="spec-box" style="width: 500px; max-width: 90%; text-align: center; position: relative; background: #1a1a1a; border: 1px solid #333; padding: 40px;">
            <button style="position: absolute; top: 15px; right: 15px; background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;" onclick="document.getElementById('workbench-start-modal').classList.remove('open')">×</button>
            <h2 style="margin-bottom: 20px;">Ready to Fabricate?</h2>
            <img id="wb-start-img" src="" style="width: 100%; height: 300px; object-fit: cover; border-radius: 8px; margin-bottom: 20px;">
            <p style="color: #888; margin-bottom: 30px;">Ensure material is loaded and bed is clear.</p>
            <button class="btn-buy" onclick="confirmStartFabrication()">Start</button>
        </div>
    </div>

    <!-- Back to Top Button -->
    <button id="back-to-top" onclick="scrollToTop()">
        <svg class="icon" viewBox="0 0 24 24"><polyline points="18 15 12 9 6 15"></polyline></svg>
    </button>

    <!-- Cursor Elements -->
    <div class="cursor-dot" id="cursor-dot"></div>
    <div class="cursor-outline" id="cursor-outline"></div>

    <!-- Search Modal -->
    <div class="search-modal" id="search-modal" onclick="if(event.target === this) toggleSearch()">
        <div class="search-container">
            <input type="text" class="search-input" id="search-input" placeholder="Search designs, materials, or pages..." onkeyup="handleSearch()">
            <div class="search-results" id="search-results"></div>
        </div>
    </div>

    <div class="mobile-nav-overlay" id="mobile-nav">
        <button style="position:absolute; top:30px; right:30px; color:white; font-size:30px; border:none; background:none;" onclick="toggleMobileMenu()">✕</button>
        <a class="mobile-nav-link" onclick="toggleMobileMenu(); nav('product')">Product</a>
        <a class="mobile-nav-link" onclick="toggleMobileMenu(); nav('design')">Mall</a>
        <a class="mobile-nav-link" onclick="toggleMobileMenu(); nav('workbench')">Workbench</a>
        <a class="mobile-nav-link" onclick="toggleMobileMenu(); nav('community')">Community</a>
    </div>

    <header>
        <div class="logo" onclick="nav('home')">
            <img src="logo_header.png" alt="MARINOW" class="logo-img">
        </div>
        <div class="nav-group">
            <button class="nav-btn" id="btn-product" onclick="nav('product')"><svg class="icon" viewBox="0 0 24 24"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg><span>Product</span></button>
            <button class="nav-btn" id="btn-design" onclick="nav('design')"><svg class="icon" viewBox="0 0 24 24"><path d="M20.38 3.46L16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z"/></svg><span>Mall</span></button>
            <button class="nav-btn" id="btn-workbench" onclick="nav('workbench')"><svg class="icon" viewBox="0 0 24 24"><line x1="4" y1="21" x2="4" y2="14"></line><line x1="4" y1="10" x2="4" y2="3"></line><line x1="12" y1="21" x2="12" y2="12"></line><line x1="12" y1="8" x2="12" y2="3"></line><line x1="20" y1="21" x2="20" y2="16"></line><line x1="20" y1="12" x2="20" y2="3"></line><line x1="1" y1="14" x2="7" y2="14"></line><line x1="9" y1="8" x2="15" y2="8"></line><line x1="17" y1="16" x2="23" y2="16"></line></svg><span>Workbench</span></button>
            <button class="nav-btn" id="btn-community" onclick="nav('community')"><svg class="icon" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg><span>Community</span></button>
            
            <!-- Search Icon -->
            <button class="nav-btn" onclick="toggleSearch()">
                <svg class="icon" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
            </button>

            <div class="cart-icon-container" onclick="nav('cart'); renderCart();">
                <svg class="icon" viewBox="0 0 24 24"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
                <div class="cart-badge" id="cart-badge">0</div>
            </div>
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">☰</button>
            <button class="cta-btn" onclick="alert('Login / Connect Wallet')">Log In</button>
        </div>
    </header>

    <!-- Home -->
    <div id="home" class="fade-in">
        <section id="home-hero">
            <div class="hero-bg"><img src="hero_01.png" class="active"><img src="hero_02.png"><img src="hero_03.png"><div class="hero-overlay"></div></div>
            <div class="hero-content reveal active">
                <h1 class="hero-title">MAKE <br><span class="gradient-text">RIGHT NOW</span></h1>
                <p class="hero-subtitle">The world's first autonomous clothing manufacturing ecosystem.</p>
                <button class="btn-main" onclick="nav('product')">Explore Collection &rarr;</button>
            </div>
        </section>
        <section class="home-grid reveal">
            <div class="grid-item" onclick="nav('product')"><div class="grid-icon"><svg class="icon" viewBox="0 0 24 24"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg></div><div class="grid-title">Product</div><div class="grid-desc">Marinow One: All-in-one Factory</div></div>
            <div class="grid-item" onclick="nav('design')"><div class="grid-icon"><svg class="icon" viewBox="0 0 24 24"><path d="M20.38 3.46L16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z"/></svg></div><div class="grid-title">Mall</div><div class="grid-desc">Original works & Copyrights</div></div>
            <div class="grid-item" onclick="nav('workbench')"><div class="grid-icon"><svg class="icon" viewBox="0 0 24 24"><line x1="4" y1="21" x2="4" y2="14"></line><line x1="4" y1="10" x2="4" y2="3"></line><line x1="12" y1="21" x2="12" y2="12"></line><line x1="12" y1="8" x2="12" y2="3"></line><line x1="20" y1="21" x2="20" y2="16"></line><line x1="20" y1="12" x2="20" y2="3"></line><line x1="1" y1="14" x2="7" y2="14"></line><line x1="9" y1="8" x2="15" y2="8"></line><line x1="17" y1="16" x2="23" y2="16"></line></svg></div><div class="grid-title">Workbench</div><div class="grid-desc">Create & Customize</div></div>
            <div class="grid-item" onclick="nav('community')"><div class="grid-icon"><svg class="icon" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg></div><div class="grid-title">Community</div><div class="grid-desc">Join the revolution</div></div>
        </section>
    </div>

    <!-- Product (Machine) -->
    <section id="product" class="page-section hidden">
        <div class="container">
            <div class="section-header reveal"><h2 class="section-title">Marinow One</h2><button class="btn-back" onclick="nav('home')">← Back Home</button></div>
            <div class="product-layout reveal" id="product-slider-container">
                <div class="product-img"><img id="product-display-img" src="prod_01.png"><button class="slider-btn prev-btn" onclick="switchProduct(-1)">&#10094;</button><button class="slider-btn next-btn" onclick="switchProduct(1)">&#10095;</button><div class="slider-dots"><span class="dot active" id="dot-0"></span><span class="dot" id="dot-1"></span><span class="dot" id="dot-2"></span><span class="dot" id="dot-3"></span></div></div>
                <div class="product-info-container">
                    <div class="product-description">
                        <div class="info-header"><h1 style="font-size: 2.5rem; margin: 0;">Autonomous Fabricator</h1><div class="badge">FLAGSHIP</div></div>
                        <p>The Marinow One represents a paradigm shift in garment manufacturing. By condensing industrial-grade weaving, laser-cutting, and robotic stitching capabilities into a single unit, it empowers creators to move from digital concept to physical reality in hours.</p>
                        <p>Powered by advanced intelligent algorithms, the machine automatically optimizes material usage, ensuring zero-waste production while handling complex geometries that traditional manufacturing cannot achieve.</p>
                    </div>
                    <div class="spec-box">
                        <div class="price-tag">$4,999.00 <span style="font-size:1rem; color:#666">USD</span></div>
                        <ul class="spec-list"><li><strong>Build Volume</strong> <span>1300 x 1200 mm</span></li><li><strong>Materials</strong> <span>Cotton, Silk, Bio-Fibers</span></li><li><strong>Speed</strong> <span>45 mins / T-Shirt</span></li></ul>
                        <button class="btn-buy" onclick="addToCart('machine')">Pre-order Now</button>
                    </div>
                </div>
            </div>
            <div class="detail-section reveal"><div class="detail-grid-split"><div class="detail-text"><h3>Modular Toolheads</h3><p>The magnetic quick-swap toolhead system allows for seamless transitions between cutting, finishing, and stitching.</p><ul style="color:#888; margin-top:10px; list-style:disc; padding-left:20px;"><li>Laser Cutter</li><li>Smart Iron</li><li>Sewing Head</li></ul></div><div class="detail-img-box"><img src="prod_detail_02.png"></div></div></div>
            <div class="detail-section detail-full-width reveal"><div style="max-width: 800px; margin: 0 auto;"><h3 style="font-size: 2.5rem; margin-bottom: 10px; background: linear-gradient(90deg, #fff, #888); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Precision Engineering</h3><p style="color:#999; font-size: 1.1rem;">From the rigid aluminum gantry to the silent stepper drivers, Marinow One is built to last.</p></div><img src="prod_detail_01.png" class="detail-full-img"></div>
            <div style="text-align: center; margin-top: 80px; padding-bottom: 40px;">
                <h3 style="margin-bottom: 20px;">Ready to Create?</h3>
                <button class="btn-main" onclick="nav('design')">Explore Fashion Mall &rarr;</button>
            </div>
        </div>
    </section>

    <!-- Design (Renamed to Mall/Marketplace) -->
    <section id="design" class="page-section hidden">
        <div class="container">
            <div class="section-header reveal"><h2 class="section-title">MARINOW Mall</h2><button class="btn-back" onclick="nav('home')">← Back Home</button></div>
            <div class="design-grid reveal" id="design-grid-container">
                <!-- JS generated -->
            </div>
        </div>
    </section>

    <!-- Design Detail -->
    <section id="clothing-detail" class="page-section hidden">
        <div class="container">
            <button class="btn-back" style="margin-bottom: 20px;" onclick="nav('design')">← Back to Mall</button>
            <div class="product-layout" style="flex-direction: row; gap: 60px;">
                <div class="product-img" style="aspect-ratio: auto; height: 600px;"><img id="detail-img-target" src="" alt="Cloth"></div>
                <div class="product-info">
                    <div class="badge">DIGITAL PATTERN</div>
                    <h1 id="detail-title-target" style="font-size: 2.5rem; margin-top: 10px;">Title</h1>
                    <p id="detail-description" style="color: #888; margin-top: 20px;">Includes 3D schematic and sewing instructions. Protected by blockchain copyright.</p>
                    
                    <!-- NEW: Manufacturing Data Specs -->
                    <div class="detail-specs">
                        <div class="spec-item"><span class="spec-label">Machine Time</span><span class="spec-value" id="detail-time">--</span></div>
                        <div class="spec-item"><span class="spec-label">Process</span><span class="spec-value" id="detail-tech">--</span></div>
                        <div class="spec-item"><span class="spec-label">Material</span><span class="spec-value" id="detail-mat">--</span></div>
                    </div>

                    <div class="price-tag">$45.00 <span style="font-size:1rem; color:#666">/ License</span></div>
                    <div style="display: flex; gap: 20px; margin-top: 30px;">
                        <button class="btn-buy" style="margin:0; background: #333;" onclick="addToCart('design')">Add to Bag</button>
                        <!-- Updated Button ID and OnClick -->
                        <button id="detail-buy-btn" class="btn-buy" style="margin:0;" onclick="triggerPurchaseFlow()">Buy Now</button>
                    </div>
                    <div style="margin-top: 40px; border-top: 1px solid #222; padding-top: 20px; cursor: pointer;" onclick="openDesigner(currentDesigner)"><small>Designed by</small><h4 id="detail-designer-target" style="margin-top:5px;">Designer Name</h4></div>
                </div>
            </div>

            <!-- NEW: User Reviews Section -->
            <div class="detail-reviews-section">
                <h3 class="detail-reviews-title">User Reviews</h3>
                <div id="detail-reviews-container">
                    <!-- Reviews will be injected here by JS -->
                </div>
            </div>
        </div>
    </section>

    <!-- Designer Detail -->
    <section id="designer-detail" class="page-section hidden">
        <div class="container">
            <button class="btn-back" style="margin-bottom: 20px;" onclick="nav('design')">← Back to Design</button>
            <div style="text-align: center; margin-bottom: 60px;">
                <img src="" id="designer-profile-pic" style="width: 120px; height: 120px; border-radius: 50%; border: 2px solid #7b61ff;">
                <h1 id="designer-profile-name" style="margin-top: 20px;">Name</h1>
                <p style="color: #888;">Avant-garde Fashion Architect</p>
            </div>
            <h3>More from this Creator</h3>
            <div class="design-grid" style="margin-top: 30px;" id="designer-portfolio-grid"></div>
        </div>
    </section>

    <!-- Workbench (Fixed & Expanded with Upload) -->
    <section id="workbench" class="page-section hidden">
        <div class="container">
            <div class="section-header reveal"><h2 class="section-title">Creator Studio</h2><button class="btn-back" onclick="nav('home')">← Back Home</button></div>
            <div class="workbench-ui reveal">
                <div class="preview-area">
                    <div class="preview-content">
                        <div id="preview-texture" class="preview-overlay"></div><div id="preview-color" class="preview-color"></div>
                        <div style="text-align: center; position: relative; z-index: 2;">
                            <svg id="wb-preview-icon" class="icon workbench-icon" style="width: 50px; height: 50px; margin-bottom: 10px; opacity: 0.5;" viewBox="0 0 24 24"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
                            <h2 id="wb-project-name">Empty Project</h2><p style="color: #666;">Load a design to begin visualization</p>
                        </div>
                    </div>
                </div>
                <div class="control-panel">
                    <!-- NEW: Upload Button Area -->
                    <div style="margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 20px;">
                        <input type="file" id="user-design-upload" style="display: none;" accept=".png,.jpg,.jpeg,.obj" onchange="handleFileUpload(this)">
                        <button class="btn-back" style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 10px;" onclick="document.getElementById('user-design-upload').click()">
                            <svg class="icon" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                            Upload Custom Design
                        </button>
                    </div>

                    <h3>Configuration</h3>
                    <div class="form-group"><label>Material</label>
                        <div class="material-grid">
                            <div class="material-card" onclick="selectMat(this, 'mat_01.png')"><img src="mat_01.png" class="material-img"><div class="material-name">Raw Linen</div></div>
                            <div class="material-card" onclick="selectMat(this, 'mat_02.png')"><img src="mat_02.png" class="material-img"><div class="material-name">Organic Cotton</div></div>
                            <div class="material-card" onclick="selectMat(this, 'mat_03.png')"><img src="mat_03.png" class="material-img"><div class="material-name">Corduroy</div></div>
                            <div class="material-card" onclick="selectMat(this, 'mat_04.png')"><img src="mat_04.png" class="material-img"><div class="material-name">Bio-Silk</div></div>
                            <div class="material-card" onclick="selectMat(this, 'mat_05.png')"><img src="mat_05.png" class="material-img"><div class="material-name">Syn-Wool</div></div>
                        </div>
                    </div>
                    <div class="form-group"><label>Color Tint</label>
                        <div class="color-options">
                            <div class="color-circle selected" style="background: transparent; border-color: white;" onclick="selectColor(this, 'transparent')"></div>
                            <div class="color-circle" style="background: #e74c3c;" onclick="selectColor(this, '#e74c3c')"></div>
                            <div class="color-circle" style="background: #3498db;" onclick="selectColor(this, '#3498db')"></div>
                            <div class="color-circle" style="background: #2ecc71;" onclick="selectColor(this, '#2ecc71')"></div>
                            <div class="color-circle" style="background: #9b59b6;" onclick="selectColor(this, '#9b59b6')"></div>
                            <div class="color-circle" style="background: #f1c40f;" onclick="selectColor(this, '#f1c40f')"></div>
                            <div class="color-circle" style="background: #e67e22;" onclick="selectColor(this, '#e67e22')"></div>
                            <div class="color-circle" style="background: #1abc9c;" onclick="selectColor(this, '#1abc9c')"></div>
                            <div class="color-circle" style="background: #34495e;" onclick="selectColor(this, '#34495e')"></div>
                            <div class="color-circle" style="background: #ecf0f1;" onclick="selectColor(this, '#ecf0f1')"></div>
                        </div>
                    </div>
                    <button class="btn-buy" style="margin-top: 10px;" onclick="startFabrication()">Start Fabrication</button>
                </div>
            </div>
        </div>
    </section>

    <!-- NEW: Fabrication Progress Interface (Interactive Timeline with Pause & Back) -->
    <section id="fabrication-process" class="page-section hidden">
        <div class="container">
            <!-- Header with Back Button and Badge (Matching Clothing Detail Back Button) -->
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 40px;">
                <button class="btn-back" style="margin-bottom: 0;" onclick="stopFabricationAndReturn()">← Back to Workbench</button>
                <div class="badge">LIVE FEED</div>
            </div>

            <div style="display:flex; flex-direction:column; align-items:center; margin-top: 40px;">
                
                <!-- Main Visual Display Area -->
                <div class="fab-display-card">
                    <img id="fab-step-img" class="fab-display-img" src="https://image.pollinations.ai/prompt/futuristic%20fabric%20weaving%20machine%20close%20up?width=800&height=600&nologo=true">
                    <div class="fab-display-info">
                        <h3 id="fab-step-title" class="fab-display-title">Initializing System</h3>
                        <p id="fab-step-desc" class="fab-display-desc">The Marinow One is performing self-diagnostics, leveling the build plate, and pre-heating the extrusion nozzles to 210°C.</p>
                    </div>
                </div>

                <!-- Interactive Timeline -->
                <div class="fab-timeline-container">
                    <div class="fab-progress-line-bg"></div>
                    <div class="fab-progress-line-fill" id="fab-line-fill"></div>
                    <div class="fab-steps" id="fab-steps-wrapper">
                        <!-- Nodes generated by JS -->
                    </div>
                </div>
                
                <!-- Status Text -->
                <p id="fab-status-text">System Ready...</p>

                <!-- Pause Button -->
                <button id="fab-pause-btn" class="btn-buy" style="width:auto; padding: 10px 30px; margin-top:15px; background: #333;" onclick="toggleFabricationPause()">Pause</button>
                
                <!-- Finish Button (Hidden initially) -->
                <button id="fab-finish-btn" class="btn-buy hidden" style="width:auto; margin-top:20px; display:none;" onclick="nav('workbench')">Collect Garment & Return</button>
            </div>
        </div>
    </section>

    <!-- Cart Section -->
    <section id="cart" class="page-section hidden">
        <div class="container">
            <div class="section-header"><h2 class="section-title">Your Bag</h2><button class="btn-back" onclick="nav('home')">← Shopping</button></div>
            <div class="cart-layout"><div id="cart-items-container"></div><div class="cart-summary"><h3>Order Summary</h3><div class="summary-row"><span>Subtotal</span><span id="cart-subtotal">$0.00</span></div><div class="summary-row"><span>Tax (Est.)</span><span id="cart-tax">$0.00</span></div><div class="summary-total"><span>Total</span><span id="cart-total">$0.00</span></div><button class="btn-buy" onclick="alert('Proceeding to checkout...')">Checkout</button></div></div>
        </div>
    </section>

    <!-- Community (With Persistence) -->
    <section id="community" class="page-section hidden">
        <div class="container">
            <div class="section-header reveal"><h2 class="section-title">The Network</h2><button class="btn-back" onclick="nav('home')">← Back Home</button></div>
            <div class="community-feed reveal" id="community-feed-container"></div>
        </div>
    </section>

    <!-- Footer Pages (Expanded Content) -->
    <section id="materials" class="page-section hidden">
        <div class="container">
            <div class="section-header"><h2 class="section-title">Materials Library</h2><button class="btn-back" onclick="nav('home')">← Back Home</button></div>
            <div class="text-page" style="margin-bottom:40px;">
                <h3 style="margin-top:0">Sustainable Innovation</h3>
                <p>Our materials are sourced from regenerative farms and recycled waste streams. We prioritize biodegradability without compromising on durability or aesthetics. Every spool is tracked on the blockchain to ensure 100% transparency from fiber to fabric.</p>
            </div>
            <div class="grid-cards-simple">
                <div class="simple-card"><h4>Bio-Silk</h4><p>Lab-grown spider silk analog. 40% stronger than steel by weight, yet soft to the touch.</p></div>
                <div class="simple-card"><h4>Carbon Cotton</h4><p>Cotton infused with activated carbon for odor absorption and enhanced durability.</p></div>
                <div class="simple-card"><h4>Syn-Wool</h4><p>Zero microplastic shedding synthetic wool alternative. Superior thermal retention.</p></div>
                <div class="simple-card"><h4>Smart Conductive</h4><p>Threads capable of carrying low-voltage current for wearable tech integration.</p></div>
                <div class="simple-card"><h4>Recycled Poly</h4><p>Made from 100% post-consumer ocean plastic. Water-resistant and lightweight.</p></div>
                <div class="simple-card"><h4>Hemp Fiber</h4><p>Natural, breathable, and anti-microbial. Uses 50% less water than cotton to grow.</p></div>
            </div>
        </div>
    </section>

    <section id="software" class="page-section hidden">
        <div class="container text-page">
            <div class="section-header"><h2 class="section-title">Marinow OS</h2><button class="btn-back" onclick="nav('home')">Back</button></div>
            <p>The brain behind the machine. Marinow OS translates digital 3D designs into precise G-code for manufacturing. It's compatible with CLO3D, Marvelous Designer, and Blender.</p>
            <h3>Key Features</h3>
            <ul>
                <li><strong>AI Pattern Optimization:</strong> Automatically nests patterns to minimize fabric waste by up to 30%.</li>
                <li><strong>Cloud Sync:</strong> Access your design library from any device, anywhere in the world.</li>
                <li><strong>Real-time Simulation:</strong> Preview drape, texture, and fit physics before you print a single thread.</li>
            </ul>
        </div>
    </section>

    <section id="help" class="page-section hidden">
        <div class="container text-page">
            <div class="section-header"><h2 class="section-title">Help Center</h2><button class="btn-back" onclick="nav('home')">Back</button></div>
            <div class="faq-item" onclick="this.classList.toggle('active')"><div class="faq-q">Q: How long does shipping take? <span>+</span></div><div class="faq-a">A: Orders are processed within 48 hours. Standard shipping takes 5-7 business days worldwide. Expedited options are available at checkout.</div></div>
            <div class="faq-item" onclick="this.classList.toggle('active')"><div class="faq-q">Q: What is the warranty period? <span>+</span></div><div class="faq-a">A: Marinow One comes with a 2-year comprehensive warranty covering all mechanical parts and electronics. Extended warranty is available.</div></div>
            <div class="faq-item" onclick="this.classList.toggle('active')"><div class="faq-q">Q: Can I use third-party materials? <span>+</span></div><div class="faq-a">A: Yes, Marinow One is an open-material platform. However, we highly recommend using certified Marinow materials for the best print quality and reliability.</div></div>
            <div class="faq-item" onclick="this.classList.toggle('active')"><div class="faq-q">Q: What file formats are supported? <span>+</span></div><div class="faq-a">A: We support .OBJ, .STL, .DXF, and standard digital fashion formats like .ZPRJ.</div></div>
            <div class="faq-item" onclick="this.classList.toggle('active')"><div class="faq-q">Q: Is there a maintenance schedule? <span>+</span></div><div class="faq-a">A: We recommend a basic cleaning cycle every 100 hours of operation. The machine will notify you when maintenance is required.</div></div>
            <div class="faq-item" onclick="this.classList.toggle('active')"><div class="faq-q">Q: Can I sell designs I create? <span>+</span></div><div class="faq-a">A: Absolutely. You own the rights to everything you create. You can even sell your patterns on our Design Hub marketplace.</div></div>
        </div>
    </section>

    <section id="careers" class="page-section hidden">
        <div class="container text-page">
            <div class="section-header"><h2 class="section-title">Join Us</h2><button class="btn-back" onclick="nav('home')">Back</button></div>
            <p>We are building the future of sustainable fashion. If you are passionate about robotics, AI, or textile engineering, we want to hear from you.</p>
            
            <div class="benefits-grid">
                <div class="benefit-card"><h4>Remote First</h4><p>We believe talent is everywhere. Work from anywhere in the world.</p></div>
                <div class="benefit-card"><h4>Equity</h4><p>Every employee gets stock options. Own a piece of the future.</p></div>
                <div class="benefit-card"><h4>Health & Wellness</h4><p>Comprehensive global health coverage and mental wellness stipends.</p></div>
            </div>

            <h3>Open Positions</h3>
            <div class="job-item"><div class="job-info"><h4>Senior Robotics Engineer</h4><p>R&D • San Francisco, CA</p></div><button class="cta-btn">Apply</button></div>
            <div class="job-item"><div class="job-info"><h4>Textile Scientist</h4><p>Material Science • Remote</p></div><button class="cta-btn">Apply</button></div>
            <div class="job-item"><div class="job-info"><h4>Lead Product Designer</h4><p>Design • London, UK</p></div><button class="cta-btn">Apply</button></div>
            <div class="job-item"><div class="job-info"><h4>Full Stack Developer</h4><p>Software • Remote</p></div><button class="cta-btn">Apply</button></div>
        </div>
    </section>

    <section id="press" class="page-section hidden">
        <div class="container text-page">
            <div class="section-header"><h2 class="section-title">Press Room</h2><button class="btn-back" onclick="nav('home')">Back</button></div>
            <div class="press-kit-box"><h3>Brand Assets</h3><p>Download official logos, high-res product photos, and leadership bios.</p><button class="btn-buy" style="width:auto; margin-top:10px;">Download Press Kit</button></div>
            
            <h3 style="border-bottom:1px solid #222; padding-bottom:10px; margin-bottom:30px;">In The News</h3>
            <div class="news-item"><div class="news-meta">TechCrunch • Oct 2024</div><div class="news-title">Marinow raises Series B to revolutionize home garment manufacturing</div><div class="news-snippet">The startup aims to end fast fashion by putting the factory in your living room.</div></div>
            <div class="news-item"><div class="news-meta">Vogue Business • Sep 2024</div><div class="news-title">The Rise of Decentralized Fashion: How Marinow is changing the game</div><div class="news-snippet">Designers are flocking to the new platform that promises instant royalties and zero waste.</div></div>
            <div class="news-item"><div class="news-meta">Wired • Aug 2024</div><div class="news-title">Review: The Marinow One is the 3D printer for your wardrobe</div><div class="news-snippet">It's not just a sewing machine; it's a complete production line. And it actually works.</div></div>
        </div>
    </section>

    <section id="contact" class="page-section hidden">
        <div class="container text-page">
            <div class="section-header"><h2 class="section-title">Contact Us</h2><button class="btn-back" onclick="nav('home')">Back</button></div>
        <form onsubmit="event.preventDefault(); showToast('Message Sent')"><label>Name</label><input type="text" class="form-input" placeholder="Your Name"><label>Email</label><input type="email" class="form-input" placeholder="your@email.com"><label>Message</label><textarea class="form-input form-textarea" placeholder="How can we help?"></textarea><button class="btn-buy">Send Message</button></form>
        </div>
    </section>

    <section id="about" class="page-section hidden">
        <div class="container text-page">
            <div class="section-header"><h2 class="section-title">About Us</h2><button class="btn-back" onclick="nav('home')">Back</button></div>
            <h3>Our Story</h3>
            <p>Marinow was founded in 2024 on a radical idea: that clothing should be produced locally, on-demand, and without waste. We started in a small garage in Palo Alto, hacking together 3D printer parts and sewing machines to create the first prototype of the Marinow One.</p>
            <h3>Our Vision</h3>
            <p>We envision a world where "mass production" is a relic of the past. A world where every garment fits perfectly, expresses individual identity, and leaves no carbon footprint. We are democratizing fashion design and manufacturing, putting the power back into the hands of creators.</p>
            <h3>Leadership</h3>
            <div class="team-grid">
                <div class="team-member"><img src="leader.png"><h4>Chen Deyang</h4><p>CEO & Co-Founder</p></div>
            </div>
        </div>
    </section>

    <section id="legal" class="page-section hidden">
        <div class="container text-page">
            <div class="section-header"><h2 class="section-title">Legal</h2><button class="btn-back" onclick="nav('home')">Back</button></div>
            <div class="legal-text">
                <h4>1. Terms of Service</h4>
                <p>By accessing the Marinow website and using the Marinow One hardware, you agree to comply with these terms. Intellectual property rights for all designs created on the platform remain with the creator, subject to our licensing agreements. Unauthorized reproduction of DRM-protected patterns is strictly prohibited.</p>
                <br>
                <h4>2. Privacy Policy</h4>
                <p>We value your privacy. We collect only essential data required for order processing and device synchronization. Your 3D body scan data is encrypted locally on your device and is never sold to third parties. Cloud synchronization is optional and user-controlled.</p>
                <br>
                <h4>3. Data Security</h4>
                <p>All transmission of data between the Marinow One app and our servers is encrypted using TLS 1.3. We employ regular third-party security audits to ensure the integrity of our systems.</p>
                <br>
                <h4>4. Refund Policy</h4>
                <p>Hardware may be returned within 30 days of receipt for a full refund, provided it is in original condition. Digital assets (patterns, software licenses) are non-refundable once downloaded or activated.</p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-logo"><img src="logo_header.png" alt="MARINOW" class="footer-logo-img"><p style="margin-top:10px; color: #666;">Redefining the silhouette of tomorrow.</p></div>
            <div class="footer-col"><h4>Product</h4><ul><li><a onclick="nav('product')">Marinow One</a></li><li><a onclick="nav('materials')">Materials</a></li><li><a onclick="nav('software')">Software</a></li></ul></div>
            <div class="footer-col"><h4>Resources</h4><ul><li><a onclick="nav('help')">Help Center</a></li><li><a onclick="nav('community')">Community</a></li><li><a onclick="nav('contact')">Contact</a></li></ul></div>
            <div class="footer-col"><h4>Company</h4><ul><li><a onclick="nav('about')">About Us</a></li><li><a onclick="nav('careers')">Careers</a></li><li><a onclick="nav('press')">Press</a></li></ul></div>
        </div>
        <div class="footer-bottom"><p>&copy; 2025 Marinow Inc. All rights reserved.</p><div style="display: flex; gap: 20px;"><a onclick="nav('legal')">Privacy Policy</a><a onclick="nav('legal')">Terms of Service</a></div></div>
    </footer>

    <script>
        let currentDesigner = "";
        let currentItemName = "";
        let cartItems = [];
        let fabricationTimer = null; // Global timer variable
        let isFabPaused = false;     // Pause flag
        let isWaitingForUser = false; // New flag

        // --- Global Search Logic & Data ---
        // NEW: Added 4 new designs (IDs 6-9) and SALES data + REVIEWS
        const designs = [
            { 
                id: 1, title: "Shadow Cloak", designer: "Marcus V", avatar: "https://randomuser.me/api/portraits/men/32.jpg", img: "img_01.png", badge: "DRM Protected", time: "3h 45m", tech: "Weave + Laser", mat: "Carbon Cotton", sales: "1.2k",
                desc: "The Shadow Cloak is a masterpiece of modern stealth aesthetics. Crafted from high-density Carbon Cotton, it offers unparalleled durability and a sleek, matte finish. The oversized hood and fluid drape create a mysterious silhouette.",
                reviews: [
                    { user: "CyberGoth99", avatar: "https://randomuser.me/api/portraits/women/10.jpg", rating: "★★★★★", text: "The drape on this cloak is incredible. The carbon cotton feels surprisingly light." },
                    { user: "TechWear_Fan", avatar: "https://randomuser.me/api/portraits/men/22.jpg", rating: "★★★★☆", text: "Great pattern, but took a bit longer to print than expected." }
                ]
            },
            { 
                id: 2, title: "Solar Geometric", designer: "Elena K", avatar: "https://randomuser.me/api/portraits/women/44.jpg", img: "img_02.png", badge: "DRM Protected", time: "2h 15m", tech: "Smart Knit", mat: "Bio-Silk", sales: "890",
                desc: "Inspired by solar panel arrays, this design features geometric tessellations that catch the light. Made from Bio-Silk, it is incredibly soft yet resilient, perfect for both casual wear and high-fashion statements.",
                reviews: [
                    { user: "SunnyD", avatar: "https://randomuser.me/api/portraits/women/12.jpg", rating: "★★★★★", text: "Love the texture! It really catches the light." }
                ]
            },
            { 
                id: 3, title: "Abstract Canvas", designer: "System_01", avatar: "https://randomuser.me/api/portraits/men/86.jpg", img: "img_03.png", badge: "Open Source", time: "4h 00m", tech: "3D Print Mix", mat: "Recycled Poly", sales: "3.4k",
                desc: "A true open-source project, Abstract Canvas encourages modification. The chaotic yet controlled pattern is generated algorithmically, making every instance slightly unique.",
                reviews: [
                    { user: "OpenMaker", avatar: "https://randomuser.me/api/portraits/men/55.jpg", rating: "★★★★★", text: "Best open source pattern on the platform. Highly customizable." },
                    { user: "EcoWarrior", avatar: "https://randomuser.me/api/portraits/women/33.jpg", rating: "★★★★★", text: "Printed perfectly with recycled filament." }
                ]
            },
            { 
                id: 4, title: "Chromatic Mosaic", designer: "Elena K", avatar: "https://randomuser.me/api/portraits/women/44.jpg", img: "img_04.png", badge: "Limited Edition", time: "5h 30m", tech: "Multi-Thread", mat: "Syn-Wool", sales: "450",
                desc: "A vibrant exploration of color theory. The Chromatic Mosaic uses advanced multi-thread weaving to create a seamless gradient effect that is impossible with traditional dyeing methods.",
                reviews: [
                    { user: "ColorLvr", avatar: "https://randomuser.me/api/portraits/women/9.jpg", rating: "★★★★☆", text: "Beautiful colors, but requires frequent spool changes." }
                ]
            },
            { 
                id: 5, title: "Washed Utility Hoodie", designer: "Kaito", avatar: "https://randomuser.me/api/portraits/men/15.jpg", img: "img_05.png", badge: "New Arrival", time: "4h 10m", tech: "Stone Wash Weave", mat: "Heavy Cotton", sales: "210",
                desc: "This oversized hoodie features a unique digital stone-wash effect programmed directly into the weaving process. Paired with multi-pocket cargo pants, it defines the modern urban utility aesthetic.",
                reviews: [
                    { user: "StreetKing", avatar: "https://randomuser.me/api/portraits/men/18.jpg", rating: "★★★★★", text: "The vintage wash effect is mind-blowing for a printed garment." }
                ]
            },
            { 
                id: 6, title: "Chrome Vanguard Jacket", designer: "Aria M", avatar: "https://randomuser.me/api/portraits/women/22.jpg", img: "img_06.png", badge: "Avant-Garde", time: "5h 50m", tech: "Metallic Fusion", mat: "Syn-Leather", sales: "1.5k",
                desc: "Pushing the boundaries of material science, this jacket uses a metallic synthetic leather that reflects the environment. The sharp, exaggerated shoulders and asymmetrical zipper create a powerful, futuristic silhouette.",
                reviews: [
                    { user: "FashionForward", avatar: "https://randomuser.me/api/portraits/women/45.jpg", rating: "★★★★★", text: "Stunning structure. It holds its shape perfectly." },
                    { user: "SciFiLover", avatar: "https://randomuser.me/api/portraits/men/11.jpg", rating: "★★★★☆", text: "Looks exactly like the render." }
                ]
            },
            { 
                id: 7, title: "Neon Cyber Trench", designer: "Unit 734", avatar: "https://randomuser.me/api/portraits/men/5.jpg", img: "img_07.png", badge: "Cyberpunk", time: "6h 15m", tech: "LED Integration", mat: "Reflective Tech-Poly", sales: "670",
                desc: "The ultimate cyberpunk statement piece. This trench coat features integrated electroluminescent piping that glows in low light. The holographic fabric shifts color as you move.",
                reviews: [
                    { user: "NeonDemon", avatar: "https://randomuser.me/api/portraits/men/67.jpg", rating: "★★★★★", text: "The lighting effects are even brighter in person." }
                ]
            },
            { 
                id: 8, title: "Modern Executive Set", designer: "SportX", avatar: "https://randomuser.me/api/portraits/women/90.jpg", img: "img_08.png", badge: "Luxury", time: "7h 45m", tech: "Precision Laser Tailoring", mat: "Wool & Vegan Leather", sales: "2.1k",
                desc: "A modern twist on the power suit. Featuring a cropped beige blazer with sharp lapels and high-waisted, tailored leather trousers. The fit is engineered to perfection using body-scan data.",
                reviews: [
                    { user: "BossLady", avatar: "https://randomuser.me/api/portraits/women/88.jpg", rating: "★★★★★", text: "Incredible fit. The leather is buttery soft." }
                ]
            },
            { 
                id: 9, title: "Deconstructed Shadow Robe", designer: "System_01", avatar: "https://randomuser.me/api/portraits/men/86.jpg", img: "img_09.png", badge: "Auction Only", time: "6h 20m", tech: "Zero-Waste Patchwork", mat: "Textured Linen Blend", sales: "12",
                desc: "A dark avant-garde masterpiece. Using distinct textures of black and dark grey fabrics, this robe is constructed through a zero-waste patchwork technique, creating rich layers and a fluid drape.",
                reviews: [
                    { user: "Collector01", avatar: "https://randomuser.me/api/portraits/men/99.jpg", rating: "★★★★★", text: "A masterpiece of digital tailoring." }
                ]
            }
        ];
        
        // --- Fabrication Steps Data (Interactive) ---
        const fabricationSteps = [
            { 
                label: "Init", 
                title: "Initialization & Calibration", 
                desc: "The system is running self-diagnostics, loading the G-code pattern, and leveling the build plate. Extruders are pre-heating to 210°C.",
                img: "https://image.pollinations.ai/prompt/futuristic%203d%20printer%20nozzle%20calibration%20hud?width=800&height=600&nologo=true" 
            },
            { 
                label: "Cut", 
                title: "Laser Cutting Base Layer", 
                desc: "High-precision laser cutters are sculpting the raw fabric material based on the vector paths. Edges are automatically cauterized to prevent fraying.",
                img: "https://image.pollinations.ai/prompt/laser%20cutting%20fabric%20glowing%20red%20beam%20industrial?width=800&height=600&nologo=true" 
            },
            { 
                label: "Weave", 
                title: "Weaving & Extrusion", 
                desc: "The loom toolhead is interweaving the secondary fibers. Bio-silk strands are being extruded to form the structural mesh of the garment.",
                img: "https://image.pollinations.ai/prompt/macro%20weaving%20threads%20robotic%20loom%20futuristic?width=800&height=600&nologo=true" 
            },
            { 
                label: "Sew", 
                title: "Robotic Assembly", 
                desc: "Multi-axis robotic arms are stitching the panels together. Tension sensors ensure a perfect seam without puckering.",
                img: "https://image.pollinations.ai/prompt/robotic%20sewing%20arm%20needle%20macro%20detail?width=800&height=600&nologo=true" 
            },
            { 
                label: "Finish", 
                title: "Finishing & QC", 
                desc: "Steam treatment is applied to relax the fibers. Optical cameras scan the final garment for any defects before releasing the lock.",
                img: "https://image.pollinations.ai/prompt/steam%20ironing%20clothing%20high%20tech%20factory?width=800&height=600&nologo=true" 
            }
        ];

        const searchablePages = [
            { id: 'product', title: 'Marinow One Product Page', type: 'Page' },
            { id: 'materials', title: 'Materials Library', type: 'Page' },
            { id: 'software', title: 'Marinow OS Software', type: 'Page' },
            { id: 'help', title: 'Help Center & FAQ', type: 'Page' }
        ];

        function toggleSearch() {
            const modal = document.getElementById('search-modal');
            const input = document.getElementById('search-input');
            modal.classList.toggle('open');
            if(modal.classList.contains('open')) {
                setTimeout(() => input.focus(), 100);
                input.value = '';
                document.getElementById('search-results').innerHTML = '';
            }
        }
        
        document.addEventListener('keydown', (e) => {
            if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                e.preventDefault();
                toggleSearch();
            }
            if (e.key === 'Escape') {
                document.getElementById('search-modal').classList.remove('open');
            }
        });

        function handleSearch() {
            const query = document.getElementById('search-input').value.toLowerCase();
            const resultsContainer = document.getElementById('search-results');
            resultsContainer.innerHTML = '';

            if(query.length < 2) return;

            const matchedDesigns = designs.filter(d => d.title.toLowerCase().includes(query) || d.designer.toLowerCase().includes(query));
            matchedDesigns.forEach(d => {
                const html = `
                <div class="search-result-item" onclick="toggleSearch(); openClothDetail(${d.id})">
                    <img src="${d.img}" class="loaded">
                    <div>
                        <div style="color:white; font-weight:bold;">${d.title}</div>
                        <div style="color:#666; font-size:0.8rem;">Design by ${d.designer}</div>
                    </div>
                </div>`;
                resultsContainer.insertAdjacentHTML('beforeend', html);
            });

            const matchedPages = searchablePages.filter(p => p.title.toLowerCase().includes(query));
            matchedPages.forEach(p => {
                const html = `
                <div class="search-result-item" onclick="toggleSearch(); nav('${p.id}')">
                    <div style="width:40px; height:40px; background:#333; border-radius:4px; display:flex; align-items:center; justify-content:center; color:#888;">#</div>
                    <div>
                        <div style="color:white; font-weight:bold;">${p.title}</div>
                        <div style="color:#666; font-size:0.8rem;">Page</div>
                    </div>
                </div>`;
                resultsContainer.insertAdjacentHTML('beforeend', html);
            });
        }

        // --- Persistent Community Data ---
        // NEW: Updated 'postImages' array using Pollinations AI to match comments
        const defaultPosts = [
            { id: 1, user: "Marinow_Official", tag: "Admin", avatar: "M", avatarColor: "#ff6b6b", time: "10 mins ago", text: "🚀 Firmware Update v4.5 is now live! This update reduces material waste by 15% and introduces 'Silent Mode' for overnight printing. Update via the Workbench tab.", likes: 142, postImages: ["https://image.pollinations.ai/prompt/futuristic%20firmware%20code%20screen%20blue%20hud?width=200&height=200&nologo=true", "https://image.pollinations.ai/prompt/3d%20printer%20nozzle%20macro%20silent?width=200&height=200&nologo=true"] },
            { id: 2, user: "Alex_M", tag: "Maker", avatar: "https://randomuser.me/api/portraits/men/12.jpg", type: "img", time: "45 mins ago", text: "Help needed! 🧵 I'm trying to print the 'Solar Geometric' pants using Bio-Silk (mat_04), but the seams are bunching up at the waist. Anyone have the correct tension settings for this material?", likes: 5, postImages: ["https://image.pollinations.ai/prompt/wrinkled%20silk%20fabric%20texture%20gray?width=200&height=200&nologo=true", "https://image.pollinations.ai/prompt/sewing%20machine%20needle%20jam?width=200&height=200&nologo=true", "https://image.pollinations.ai/prompt/pants%20waistband%20seam%20close%20up?width=200&height=200&nologo=true"] },
            { id: 3, user: "Sarah J.", tag: "Maker", avatar: "https://randomuser.me/api/portraits/women/65.jpg", type: "img", time: "2h ago", text: "Just finished printing the Solar Geometric set. The texture rendering on the Marinow One is insane! #DIYFashion #FutureWear", likes: 89, postImages: ["https://image.pollinations.ai/prompt/futuristic%20geometric%20pattern%20fashion%20clothing?width=200&height=200&nologo=true"] },
            { id: 4, user: "FiberTech Inc.", tag: "Factory", avatar: "F", avatarColor: "#4facfe", time: "5h ago", text: "New shipment of Smart-Conductive Thread is now compatible with Marinow One firmware v4.5. Perfect for creating heated jackets or LED-integrated designs.", likes: 230, postImages: ["https://image.pollinations.ai/prompt/glowing%20led%20thread%20spool?width=200&height=200&nologo=true", "https://image.pollinations.ai/prompt/smart%20fabric%20circuit%20macro?width=200&height=200&nologo=true"] },
            { id: 5, user: "System_01", tag: "Designer", avatar: "https://randomuser.me/api/portraits/men/86.jpg", type: "img", time: "1d ago", text: "Released 'Abstract Canvas' v2.0 source files. Improved drape dynamics and fixed the collar geometry. Download now in Design Hub.", likes: 56, postImages: ["https://image.pollinations.ai/prompt/digital%20fashion%20sketch%20wireframe?width=200&height=200&nologo=true", "https://image.pollinations.ai/prompt/abstract%20art%20clothing%20texture?width=200&height=200&nologo=true", "https://image.pollinations.ai/prompt/3d%20model%20collar%20fix?width=200&height=200&nologo=true"] }
        ];

        function getLikedPosts() {
            const stored = localStorage.getItem('marinow_liked_posts');
            return stored ? JSON.parse(stored) : [];
        }

        function renderCommunity() {
            const container = document.getElementById('community-feed-container');
            const likedPosts = getLikedPosts();
            container.innerHTML = '';

            defaultPosts.forEach(post => {
                const isLiked = likedPosts.includes(post.id);
                const likeClass = isLiked ? 'liked' : '';
                const currentLikes = isLiked ? post.likes + 1 : post.likes;
                
                let avatarHTML = post.type === 'img' ? `<img src="${post.avatar}" class="avatar">` : `<div class="avatar" style="background: ${post.avatarColor}; display: flex; align-items: center; justify-content: center; font-weight: bold;">${post.avatar}</div>`;
                let tagClass = post.tag === 'Admin' ? "tag-admin" : post.tag === 'Designer' ? "tag-designer" : post.tag === 'Factory' ? "tag-factory" : "";

                // Generate Image Grid HTML
                let imagesHTML = '';
                if(post.postImages && post.postImages.length > 0) {
                    imagesHTML = '<div class="post-images">';
                    post.postImages.forEach(img => {
                        imagesHTML += `<img src="${img}" class="post-img">`;
                    });
                    imagesHTML += '</div>';
                }

                const html = `
                <div class="feed-post">
                    <div class="post-header">${avatarHTML}<div><strong>${post.user}</strong><span class="user-tag ${tagClass}">${post.tag}</span></div><span style="margin-left: auto; color: #555; font-size: 0.8rem;">${post.time}</span></div>
                    <p>${post.text}</p>
                    ${imagesHTML}
                    <div class="post-actions">
                        <button class="post-action-item ${likeClass}" onclick="toggleLike(this, ${post.id})">
                            <svg class="icon" viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                            <span>${currentLikes}</span>
                        </button>
                        <button class="post-action-item"><svg class="icon" viewBox="0 0 24 24"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg><span>Reply</span></button>
                    </div>
                </div>`;
                container.insertAdjacentHTML('beforeend', html);
            });
        }

        function toggleLike(btn, postId) {
            let likedPosts = getLikedPosts();
            const span = btn.querySelector('span');
            let count = parseInt(span.innerText);

            if (likedPosts.includes(postId)) {
                likedPosts = likedPosts.filter(id => id !== postId);
                btn.classList.remove('liked');
                span.innerText = count - 1;
            } else {
                likedPosts.push(postId);
                btn.classList.add('liked');
                span.innerText = count + 1;
            }
            localStorage.setItem('marinow_liked_posts', JSON.stringify(likedPosts));
        }

        function renderDesignGallery() {
            const container = document.getElementById('design-grid-container');
            container.innerHTML = '';
            designs.forEach(d => {
                const html = `
                    <div class="design-card" onclick="openClothDetail(${d.id})">
                        <img src="${d.img}" class="dc-image">
                        <div class="dc-info">
                            <div class="dc-header"><h3>${d.title}</h3><span class="badge">${d.badge}</span></div>
                            <div class="designer-row" onclick="event.stopPropagation(); openDesigner('${d.designer}')">
                                <img src="${d.avatar}" class="avatar">
                                <span style="font-size: 0.9rem; color: #ccc;">by ${d.designer}</span>
                                <span style="font-size: 0.8rem; color: #666; margin-left: auto;">• ${d.sales || '100+'} Sales</span>
                            </div>
                        </div>
                    </div>`;
                container.insertAdjacentHTML('beforeend', html);
            });
        }

        // --- Cursor Logic ---
        const cursorDot = document.getElementById("cursor-dot");
        const cursorOutline = document.getElementById("cursor-outline");

        if(window.innerWidth > 768) { 
            window.addEventListener("mousemove", function(e) {
                const posX = e.clientX;
                const posY = e.clientY;
                cursorDot.style.left = `${posX}px`;
                cursorDot.style.top = `${posY}px`;
                cursorOutline.animate({
                    left: `${posX}px`,
                    top: `${posY}px`
                }, { duration: 500, fill: "forwards" });
            });
            document.querySelectorAll('a, button, .design-card, .grid-item, .material-card, .color-circle, .fab-node').forEach(el => {
                el.addEventListener('mouseenter', () => document.body.classList.add('hovering'));
                el.addEventListener('mouseleave', () => document.body.classList.remove('hovering'));
            });
        }

        // --- Workbench Tilt Logic ---
        const wbContainer = document.querySelector('.workbench-ui');
        const tiltContent = document.querySelector('.preview-content');
        if(wbContainer && tiltContent && window.innerWidth > 768) {
            wbContainer.addEventListener('mousemove', (e) => {
                const rect = wbContainer.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                const xRot = ((y / rect.height) - 0.5) * -10;
                const yRot = ((x / rect.width) - 0.5) * 10;
                tiltContent.style.transform = `rotateX(${xRot}deg) rotateY(${yRot}deg)`;
            });
            wbContainer.addEventListener('mouseleave', () => {
                tiltContent.style.transform = `rotateX(0deg) rotateY(0deg)`;
            });
        }

        // --- Init ---
        document.addEventListener("DOMContentLoaded", function() {
            renderDesignGallery();
            const images = document.querySelectorAll('img');
            images.forEach(img => { img.onload = function() { img.classList.add('loaded'); }; if(img.complete) img.classList.add('loaded'); });
            const observer = new IntersectionObserver((entries) => { entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('active'); }); }, { threshold: 0.1 });
            document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
            renderCommunity();
        });

        function nav(pageId) {
            document.querySelectorAll('.page-section, #home').forEach(el => el.classList.add('hidden'));
            
            // Check if navigating to workbench, ensure we reset to the main UI
            if(pageId === 'workbench') {
                document.getElementById('fabrication-process').style.display = 'none';
                const wb = document.getElementById('workbench');
                if(wb) wb.style.display = 'block';
            }

            const target = document.getElementById(pageId);
            if(target) {
                target.classList.remove('hidden');
                target.classList.add('fade-in');
                setTimeout(() => { target.querySelectorAll('.reveal').forEach(el => el.classList.add('active')); }, 100);
            }
            window.scrollTo(0,0);
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('nav-active'));
            const activeBtn = document.getElementById('btn-' + pageId);
            if(activeBtn) activeBtn.classList.add('nav-active');
        }
        function toggleMobileMenu() { document.getElementById('mobile-nav').classList.toggle('open'); }
        function addToCart(type) {
            let item = {};
            if (type === 'machine') item = { id: Date.now(), title: "Marinow One", type: "Hardware", price: 4999.00, img: "prod_01.png" };
            else if (type === 'design') item = { id: Date.now(), title: currentItemName || "Digital Pattern", type: "Design License", price: 45.00, img: document.getElementById('detail-img-target').src };
            cartItems.push(item);
            updateCartUI();
            showToast("Added to cart successfully");
        }
        function removeFromCart(index) { cartItems.splice(index, 1); updateCartUI(); renderCart(); }
        function updateCartUI() { const badge = document.getElementById('cart-badge'); badge.innerText = cartItems.length; badge.classList.add('show'); badge.style.transform = 'scale(1.2)'; setTimeout(() => badge.style.transform = 'scale(1)', 200); }
        function renderCart() {
            const container = document.getElementById('cart-items-container');
            container.innerHTML = '';
            let subtotal = 0;
            if (cartItems.length === 0) {
                container.innerHTML = '<div class="empty-cart-msg">Your cart is empty.<br><br><button class="btn-buy" style="width:auto;" onclick="nav(\'design\')">Browse Designs</button></div>';
                document.getElementById('cart-subtotal').innerText = "$0.00";
                document.getElementById('cart-tax').innerText = "$0.00";
                document.getElementById('cart-total').innerText = "$0.00";
                return;
            }
            cartItems.forEach((item, index) => {
                subtotal += item.price;
                const html = `<div class="cart-item"><img src="${item.img}" class="loaded"><div class="cart-item-info"><div class="cart-item-title">${item.title}</div><div class="cart-item-type">${item.type}</div></div><div class="cart-item-price">$${item.price.toFixed(2)}</div><div class="remove-btn" onclick="removeFromCart(${index})">Remove</div></div>`;
                container.insertAdjacentHTML('beforeend', html);
            });
            const tax = subtotal * 0.08;
            const total = subtotal + tax;
            document.getElementById('cart-subtotal').innerText = "$" + subtotal.toFixed(2);
            document.getElementById('cart-tax').innerText = "$" + tax.toFixed(2);
            document.getElementById('cart-total').innerText = "$" + total.toFixed(2);
        }
        function showToast(message) { const container = document.getElementById('toast-container'); const toast = document.createElement('div'); toast.className = 'toast'; toast.innerHTML = `<span>✓</span> ${message}`; container.appendChild(toast); setTimeout(() => toast.classList.add('show'), 10); setTimeout(() => { toast.classList.remove('show'); setTimeout(() => toast.remove(), 300); }, 3000); }
        
        const heroImages = document.querySelectorAll('.hero-bg img'); let currentHeroIndex = 0; 
        setInterval(() => { if(heroImages.length > 0) { heroImages[currentHeroIndex].classList.remove('active'); currentHeroIndex = (currentHeroIndex + 1) % heroImages.length; heroImages[currentHeroIndex].classList.add('active'); } }, 4000);
        
        const productImages = ['prod_01.png', 'prod_02.png', 'prod_03.png', 'prod_04.png']; let currentProdIndex = 0; 
        function switchProduct(direction) { const imgEl = document.getElementById('product-display-img'); const dots = document.querySelectorAll('.dot'); imgEl.style.opacity = 0; setTimeout(() => { currentProdIndex += direction; if(currentProdIndex >= productImages.length) currentProdIndex = 0; if(currentProdIndex < 0) currentProdIndex = productImages.length - 1; imgEl.src = productImages[currentProdIndex]; dots.forEach(d => d.classList.remove('active')); document.getElementById(`dot-${currentProdIndex}`).classList.add('active'); imgEl.onload = () => { imgEl.style.opacity = 1; } }, 200); }
        
        let touchStartX = 0; const sliderContainer = document.getElementById('product-slider-container'); if(sliderContainer) { sliderContainer.addEventListener('touchstart', e => touchStartX = e.changedTouches[0].screenX); sliderContainer.addEventListener('touchend', e => { if (e.changedTouches[0].screenX < touchStartX - 50) switchProduct(1); if (e.changedTouches[0].screenX > touchStartX + 50) switchProduct(-1); }); }
        
        // --- Updated Logic: Populate Detail Page Specs ---
        function openClothDetail(designId) { 
            const design = designs.find(d => d.id === designId);
            if(!design) return;
            currentItemName = design.title; currentDesigner = design.designer; 
            document.getElementById('detail-title-target').innerText = design.title; 
            document.getElementById('detail-designer-target').innerText = design.designer; 
            document.getElementById('detail-img-target').src = design.img; 
            
            // Populate Description if available, else fallback
            if(design.desc) {
                 document.getElementById('detail-description').innerText = design.desc;
            } else {
                 document.getElementById('detail-description').innerText = "Includes 3D schematic and sewing instructions. Protected by blockchain copyright.";
            }
            
            // Populate new spec fields
            document.getElementById('detail-time').innerText = design.time || "--";
            document.getElementById('detail-tech').innerText = design.tech || "--";
            document.getElementById('detail-mat').innerText = design.mat || "--";

            // Populate reviews
            const reviewsContainer = document.getElementById('detail-reviews-container');
            reviewsContainer.innerHTML = '';
            if(design.reviews && design.reviews.length > 0) {
                design.reviews.forEach(review => {
                    const html = `
                        <div class="review-card">
                            <div class="review-header">
                                <div class="review-user"><img src="${review.avatar}" class="review-avatar">${review.user}</div>
                                <div class="review-rating">${review.rating}</div>
                            </div>
                            <div class="review-text">${review.text}</div>
                        </div>`;
                    reviewsContainer.insertAdjacentHTML('beforeend', html);
                });
            } else {
                reviewsContainer.innerHTML = '<p style="color:#666;">No reviews yet.</p>';
            }
            
            // --- RESET BUTTON STATE ---
            const buyBtn = document.getElementById('detail-buy-btn');
            buyBtn.innerText = "Buy Now";
            buyBtn.style.background = ""; // Reset to default gradient or class style
            buyBtn.style.pointerEvents = "auto"; // Re-enable clicks
            // Reset onclick to purchase flow (in case it was changed by previous modal close)
            buyBtn.onclick = triggerPurchaseFlow; 

            nav('clothing-detail'); 
        }
        
        function openDesigner(name) { 
            const designerInfo = designs.find(d => d.designer === name);
            if(!designerInfo) return;
            document.getElementById('designer-profile-name').innerText = designerInfo.designer; 
            document.getElementById('designer-profile-pic').src = designerInfo.avatar; 
            const grid = document.getElementById('designer-portfolio-grid');
            grid.innerHTML = '';
            const works = designs.filter(d => d.designer === name);
            works.forEach(d => {
                const html = `<div class="design-card" onclick="openClothDetail(${d.id})">
                    <img src="${d.img}" class="dc-image" onload="this.classList.add('loaded')">
                    <div class="dc-info"><strong>${d.title}</strong></div>
                </div>`;
                grid.insertAdjacentHTML('beforeend', html);
            });
            nav('designer-detail'); 
        }

        // --- Trigger Purchase Flow (Open Modal) ---
        function triggerPurchaseFlow() {
            // Set modal image to current detail image
            const imgSrc = document.getElementById('detail-img-target').src;
            document.getElementById('payment-display-img').src = imgSrc;
            
            // Open Modal
            document.getElementById('payment-modal').classList.add('open');
        }

        // --- Close Payment Modal (And set state to Purchased) ---
        function closePaymentModal() {
            document.getElementById('payment-modal').classList.remove('open');
            
            // Change "Buy Now" button to "Go to Workbench"
            const buyBtn = document.getElementById('detail-buy-btn');
            buyBtn.innerText = "Go to Workbench";
            buyBtn.style.background = "#4facfe"; 
            buyBtn.style.pointerEvents = "auto";
            // NEW: Direct jump to Workbench when clicked
            buyBtn.onclick = function() {
                navToWorkbenchWithItem();
            };
        }

        // --- Proceed to Workbench from Modal ---
        function proceedToWorkbench() {
            document.getElementById('payment-modal').classList.remove('open');
            navToWorkbenchWithItem(); // Navigate
        }

        // --- NEW: Navigate to Workbench with Modal Preview ---
        function navToWorkbenchWithItem() { 
            document.getElementById('wb-project-name').innerText = currentItemName; 
            document.getElementById('wb-project-name').style.color = "#fff"; 
            
            // Set Preview Image based on current detail image
            const detailImgSrc = document.getElementById('detail-img-target').src;
            const previewOverlay = document.getElementById('preview-texture');
            previewOverlay.style.backgroundImage = `url(${detailImgSrc})`;
            previewOverlay.style.opacity = 1;
            previewOverlay.style.display = 'block';

            nav('workbench'); 
        }

        function selectMat(el, imgFile) { 
            document.querySelectorAll('.material-card').forEach(d => d.classList.remove('selected')); 
            el.classList.add('selected'); 
            // REMOVED: Image swapping logic. Left preview now remains unchanged.
        }
        function selectColor(el, colorCode) { document.querySelectorAll('.color-circle').forEach(d => d.classList.remove('selected')); el.classList.add('selected'); const colorOverlay = document.getElementById('preview-color'); if(colorCode === 'transparent') { colorOverlay.style.backgroundColor = 'transparent'; colorOverlay.style.opacity = 0; } else { colorOverlay.style.backgroundColor = colorCode; colorOverlay.style.opacity = 0.6; } }
        
        // --- NEW: File Upload Handler ---
        function handleFileUpload(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById('wb-project-name').innerText = "Custom Design";
                    document.getElementById('wb-project-name').style.color = "#4facfe";
                    currentItemName = "Custom Design";
                    
                    const previewOverlay = document.getElementById('preview-texture');
                    previewOverlay.style.backgroundImage = `url(${e.target.result})`;
                    previewOverlay.style.display = 'block';
                    
                    showToast("Design uploaded successfully");
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        // --- NEW: Start Fabrication (Open Start Modal) ---
        function startFabrication() { 
            if(document.getElementById('wb-project-name').innerText === "Empty Project") { 
                showToast("Please select or upload a design first"); 
                return; 
            }
            
            // Get current image from workbench preview
            const previewBg = document.getElementById('preview-texture').style.backgroundImage;
            
            // Handle case where background-image URL might be empty or formatted
            if(previewBg) {
                // Clean up url("...") format if necessary, or just set src directly
                const url = previewBg.slice(5, -2); 
                document.getElementById('wb-start-img').src = url;
            } else {
                // Fallback
                document.getElementById('wb-start-img').src = 'img_01.png'; 
            }

            // Open Modal
            document.getElementById('workbench-start-modal').classList.add('open');
        }

        // --- NEW: Confirm Start (Go to Progress UI) ---
        function confirmStartFabrication() {
            // Close Modal
            document.getElementById('workbench-start-modal').classList.remove('open');
            
            // Go to Progress Screen
            beginProcessUI();
        }

        // --- NEW: Internal Logic to Start Progress Bar ---
        function beginProcessUI() {
             // Setup UI
            const wbSection = document.getElementById('workbench');
            const fabSection = document.getElementById('fabrication-process');
            wbSection.style.display = 'none';
            fabSection.classList.remove('hidden');
            fabSection.style.display = 'flex';
            fabSection.classList.add('fade-in');
            
            // Generate Timeline Nodes
            const stepsContainer = document.getElementById('fab-steps-wrapper');
            stepsContainer.innerHTML = '';
            fabricationSteps.forEach((step, index) => {
                const node = document.createElement('div');
                node.className = 'fab-node';
                node.innerText = index + 1;
                node.id = `fab-node-${index}`;
                node.onmouseenter = () => showStepInfo(index); // HOVER INTERACTION
                stepsContainer.appendChild(node);
            });

            // Reset State
            document.getElementById('fab-line-fill').style.width = '0%';
            document.getElementById('fab-finish-btn').style.display = 'none';
            // Reset pause state
            isFabPaused = false;
            isWaitingForUser = false; // Reset waiting flag
            document.getElementById('fab-pause-btn').innerText = "Pause";
            document.getElementById('fab-pause-btn').style.background = "#333";
            document.getElementById('fab-status-text').style.color = "#4facfe";
            document.getElementById('fab-status-text').style.opacity = "1";
            document.getElementById('fab-pause-btn').style.display = 'inline-block'; // Ensure visible
            
            // Show first step initially
            showStepInfo(0);
            
            let progress = 0;
            let currentStepIndex = 0;
            let hasPausedForStep2 = false; // Flag to ensure we only pause once for step 2
            
            if(fabricationTimer) clearInterval(fabricationTimer);
            
            fabricationTimer = setInterval(() => { 
                if(!isFabPaused) {
                    if (progress >= 100) { 
                        clearInterval(fabricationTimer); 
                        document.getElementById('fab-status-text').innerText = "Fabrication Complete. Ready for pickup."; 
                        document.getElementById('fab-status-text').style.color = "#4caf50"; 
                        document.getElementById('fab-finish-btn').style.display = 'inline-block';
                        document.getElementById('fab-pause-btn').style.display = 'none'; // Hide pause when done
                        // Mark last node complete
                        document.getElementById(`fab-node-${fabricationSteps.length-1}`).classList.add('completed');
                        showToast("Fabrication Complete!"); 
                    } else { 
                        
                        // --- Logic for Pausing at Step 2 (30% progress) ---
                        if (Math.floor(progress) === 30 && !hasPausedForStep2) {
                            isFabPaused = true;
                            isWaitingForUser = true;
                            hasPausedForStep2 = true;
                            
                            // Update UI for alert
                            const statusText = document.getElementById('fab-status-text');
                            statusText.innerText = "⚠ ACTION REQUIRED: Please adjust fabric placement on the bed.";
                            statusText.style.color = "#e74c3c"; // Red color
                            
                            const pauseBtn = document.getElementById('fab-pause-btn');
                            pauseBtn.innerText = "Confirm & Resume";
                            pauseBtn.style.background = "#e74c3c"; // Red button background
                            pauseBtn.style.borderColor = "#e74c3c";
                            
                            return; // Exit this iteration to pause
                        }
                        
                        document.getElementById('fab-pause-btn').style.display = 'inline-block';
                        progress += 0.2; // Slower for better demo
                        document.getElementById('fab-line-fill').style.width = progress + '%';
                        
                        // Calculate active step based on progress
                        const stepIndex = Math.floor((progress / 100) * fabricationSteps.length);
                        if(stepIndex !== currentStepIndex && stepIndex < fabricationSteps.length) {
                            // Mark previous completed
                            document.getElementById(`fab-node-${currentStepIndex}`).classList.add('completed');
                            currentStepIndex = stepIndex;
                            // REMOVED: Automatic showStepInfo call
                        }
                        
                        // Mark current active
                        if(stepIndex < fabricationSteps.length) {
                            document.querySelectorAll('.fab-node').forEach(n => n.classList.remove('active'));
                            document.getElementById(`fab-node-${stepIndex}`).classList.add('active');
                        }
                    } 
                }
            }, 50); 
        }

        function showStepInfo(index) {
            const step = fabricationSteps[index];
            if(!step) return;
            const img = document.getElementById('fab-step-img');
            const desc = document.getElementById('fab-step-desc');
            
            // Simple crossfade
            img.classList.add('fade-out');
            desc.style.opacity = 0;
            
            setTimeout(() => {
                document.getElementById('fab-step-title').innerText = step.title;
                desc.innerText = step.desc;
                img.src = step.img;
                document.getElementById('fab-status-text').innerText = `Current Phase: ${step.title}...`;
                
                img.onload = () => {
                    img.classList.remove('fade-out');
                    desc.style.opacity = 1;
                };
            }, 300);
        }

        // --- NEW: Pause Toggle ---
        function toggleFabricationPause() {
            const btn = document.getElementById('fab-pause-btn');
            const status = document.getElementById('fab-status-text');

            // Special handling for the "Waiting for User" state
            if (isWaitingForUser) {
                isWaitingForUser = false;
                isFabPaused = false; // Resume
                
                // Reset UI styles
                btn.innerText = "Pause";
                btn.style.background = "#333"; 
                btn.style.borderColor = "transparent";
                
                status.innerText = "Resuming fabrication...";
                status.style.color = "#4facfe"; 
                return;
            }

            // Standard Pause/Resume Toggle
            isFabPaused = !isFabPaused;
            
            if(isFabPaused) {
                btn.innerText = "Resume";
                status.style.opacity = "0.5";
            } else {
                btn.innerText = "Pause";
                status.style.opacity = "1";
            }
        }

        function stopFabricationAndReturn() {
            if(fabricationTimer) clearInterval(fabricationTimer);
            nav('workbench');
        }
        
        // Back to Top Logic
        const backToTopBtn = document.getElementById('back-to-top');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                backToTopBtn.classList.add('visible');
            } else {
                backToTopBtn.classList.remove('visible');
            }
        });

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
